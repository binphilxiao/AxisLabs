Version 4
SHEET 1 2296 2532
WIRE 736 1232 736 1184
WIRE 848 1232 736 1232
WIRE 736 1264 736 1232
WIRE 848 1264 848 1232
WIRE -528 1392 -592 1392
WIRE -384 1392 -464 1392
WIRE 736 1392 736 1328
WIRE 848 1392 848 1328
WIRE -592 1472 -592 1392
WIRE -528 1472 -592 1472
WIRE -384 1472 -384 1392
WIRE -384 1472 -448 1472
WIRE 736 1504 736 1472
WIRE 736 1504 624 1504
WIRE 624 1536 624 1504
WIRE -944 1584 -1024 1584
WIRE -816 1584 -944 1584
WIRE -672 1584 -736 1584
WIRE 336 1584 336 1536
WIRE -96 1600 -96 1552
WIRE 208 1600 208 1552
WIRE 304 1600 208 1600
WIRE -1024 1616 -1024 1584
WIRE -944 1616 -944 1584
WIRE -512 1616 -512 1568
WIRE -128 1616 -176 1616
WIRE 512 1616 368 1616
WIRE 576 1616 512 1616
WIRE -672 1632 -672 1584
WIRE -592 1632 -592 1472
WIRE -592 1632 -672 1632
WIRE -544 1632 -592 1632
WIRE 32 1632 -64 1632
WIRE 304 1632 32 1632
WIRE -384 1648 -384 1472
WIRE -384 1648 -480 1648
WIRE -272 1648 -384 1648
WIRE -128 1648 -272 1648
WIRE 512 1648 512 1616
WIRE -592 1664 -672 1664
WIRE -544 1664 -592 1664
WIRE 336 1680 336 1648
WIRE 624 1680 624 1632
WIRE -96 1696 -96 1664
WIRE -512 1712 -512 1680
WIRE -1024 1728 -1024 1696
WIRE -944 1728 -944 1696
WIRE -944 1728 -1024 1728
WIRE -816 1728 -944 1728
WIRE -672 1728 -672 1664
WIRE -672 1728 -736 1728
WIRE 512 1760 512 1728
WIRE -592 1776 -592 1664
WIRE -464 1776 -592 1776
WIRE -272 1776 -272 1648
WIRE 224 1776 -272 1776
WIRE -464 1808 -464 1776
WIRE 848 1808 848 1472
WIRE 848 1808 624 1808
WIRE -592 1824 -592 1776
WIRE 624 1856 624 1808
WIRE -176 1872 -176 1616
WIRE -80 1872 -176 1872
WIRE 32 1872 32 1632
WIRE 32 1872 0 1872
WIRE 336 1904 336 1856
WIRE -592 1920 -592 1888
WIRE -464 1920 -464 1888
WIRE -464 1920 -592 1920
WIRE -176 1920 -176 1872
WIRE 304 1920 192 1920
WIRE 512 1936 368 1936
WIRE 576 1936 512 1936
WIRE -736 1952 -864 1952
WIRE 224 1952 224 1776
WIRE 304 1952 224 1952
WIRE 512 1968 512 1936
WIRE 336 2000 336 1968
WIRE 624 2000 624 1952
WIRE -944 2016 -944 1984
WIRE -464 2032 -464 1920
WIRE -464 2032 -608 2032
WIRE -176 2032 -176 2000
WIRE -176 2032 -464 2032
WIRE -784 2064 -784 2016
WIRE -864 2080 -864 1952
WIRE -816 2080 -864 2080
WIRE 512 2080 512 2048
WIRE -736 2096 -736 1952
WIRE -736 2096 -752 2096
WIRE -608 2096 -608 2032
WIRE -608 2096 -736 2096
WIRE -544 2096 -608 2096
WIRE -944 2112 -944 2096
WIRE -816 2112 -944 2112
WIRE -96 2128 -96 2096
WIRE -944 2144 -944 2112
WIRE 240 2144 240 2096
WIRE -784 2160 -784 2128
WIRE -96 2240 -96 2208
WIRE 32 2240 -96 2240
WIRE 240 2240 240 2224
WIRE -944 2256 -944 2224
WIRE -240 2256 -240 2192
WIRE -96 2288 -96 2240
WIRE 240 2368 240 2320
WIRE 336 2368 240 2368
WIRE -240 2384 -240 2336
WIRE -96 2416 -96 2368
WIRE 240 2416 240 2368
WIRE -96 2512 -96 2496
WIRE 240 2512 240 2496
FLAG -240 2384 0
FLAG -240 2192 3V
IOPIN -240 2192 Out
FLAG -784 2016 3V
IOPIN -784 2016 Out
FLAG -96 2512 0
FLAG 240 2512 0
FLAG -96 2096 3V
IOPIN -96 2096 Out
FLAG 240 2096 3V
IOPIN 240 2096 Out
FLAG 32 2240 Vref_1.6V
IOPIN 32 2240 Out
FLAG 336 2368 Vref_0.9V
IOPIN 336 2368 Out
FLAG -512 1568 3V
IOPIN -512 1568 Out
FLAG -512 1712 0
FLAG -96 1552 3V
IOPIN -96 1552 Out
FLAG -96 1696 0
FLAG 192 1920 Vref_0.9V
IOPIN 192 1920 In
FLAG 336 1536 3V
IOPIN 336 1536 Out
FLAG 336 1680 0
FLAG 336 2000 0
FLAG 336 1856 3V
IOPIN 336 1856 Out
FLAG 208 1552 Vref_1.6V
IOPIN 208 1552 In
FLAG -944 2256 0
FLAG -784 2160 0
FLAG -544 2096 Vref_1.5V
IOPIN -544 2096 Out
FLAG -944 1984 3V
IOPIN -944 1984 Out
FLAG 624 1680 0
FLAG 624 2000 0
FLAG 736 1184 3V
IOPIN 736 1184 Out
FLAG 512 2080 0
FLAG 512 1760 0
FLAG -272 1648 Vout_stage1
FLAG 32 1632 Vout_stage2
FLAG 512 1616 Vout_red
FLAG 624 1808 Vout_green
FLAG -944 1584 Vsns+
FLAG -944 1728 Vsns-
SYMBOL voltage -240 2240 R0
WINDOW 123 0 0 Left 2
WINDOW 39 24 124 Left 2
SYMATTR InstName V1
SYMATTR Value 3
SYMBOL current -1024 1616 R0
WINDOW 0 9 84 Left 2
WINDOW 3 -60 183 Left 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName I_bat
SYMATTR Value PWL(0 0 10 2m 20 0 30 -100m 40 0)
SYMBOL res -112 2112 R0
SYMATTR InstName R11
SYMATTR Value 1Meg
SYMBOL res -112 2272 R0
SYMATTR InstName R15
SYMATTR Value 1Meg
SYMBOL res 224 2128 R0
SYMATTR InstName R17
SYMATTR Value 1Meg
SYMBOL res 224 2400 R0
SYMATTR InstName R18
SYMATTR Value 866K
SYMATTR SpiceLine tol=1 pwr=0.1
SYMBOL res -112 2400 R0
SYMATTR InstName R19
SYMATTR Value 143k
SYMATTR SpiceLine tol=1 pwr=0.1
SYMBOL res 224 2224 R0
SYMATTR InstName R21
SYMATTR Value 1Meg
SYMATTR SpiceLine tol=1 pwr=0.1
SYMBOL res -960 1600 R0
WINDOW 0 36 51 Left 2
SYMATTR InstName Rsns1
SYMATTR Value 100m
SYMBOL res -448 1904 R180
WINDOW 0 -46 69 Left 2
WINDOW 3 -56 38 Left 2
SYMATTR InstName R22
SYMATTR Value 100k
SYMBOL res 16 1856 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R23
SYMATTR Value 9k
SYMBOL res -160 2016 R180
WINDOW 0 35 70 Left 2
WINDOW 3 36 45 Left 2
SYMATTR InstName R24
SYMATTR Value 1k
SYMBOL res -720 1568 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R25
SYMATTR Value 1k
SYMATTR SpiceLine tol=1 pwr=0.1
SYMBOL res -960 2000 R0
WINDOW 3 30 80 Left 2
SYMATTR Value 1Meg
SYMATTR InstName R26
SYMBOL res -960 2128 R0
WINDOW 3 30 81 Left 2
SYMATTR Value 1Meg
SYMATTR InstName R27
SYMBOL Opamps\\LTC6241 336 1616 R0
SYMATTR InstName U7
SYMBOL Opamps\\LTC6241 336 1936 R0
SYMATTR InstName U8
SYMBOL res -720 1712 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R28
SYMATTR Value 1k
SYMATTR SpiceLine tol=1 pwr=0.1
SYMBOL res -432 1456 R90
WINDOW 0 12 111 VBottom 2
WINDOW 3 -13 3 VTop 2
SYMATTR InstName R29
SYMATTR Value 100k
SYMBOL Opamps\\LTC2054 -96 1632 R0
SYMATTR InstName U9
SYMBOL Opamps\\LTC2054 -512 1648 R0
SYMATTR InstName U10
SYMBOL cap -608 1824 R0
WINDOW 0 32 15 Left 2
WINDOW 3 33 48 Left 2
SYMATTR InstName C1
SYMATTR Value 1µ
SYMBOL cap -464 1376 R90
WINDOW 0 9 61 VBottom 2
WINDOW 3 -16 -7 VTop 2
SYMATTR InstName C2
SYMATTR Value 1µ
SYMBOL nmos 576 1536 R0
SYMATTR InstName M1
SYMBOL nmos 576 1856 R0
SYMATTR InstName M2
SYMBOL LED 720 1264 R0
SYMATTR InstName D1
SYMBOL LED 832 1264 R0
SYMATTR InstName D2
SYMBOL res 720 1376 R0
WINDOW 0 36 51 Left 2
SYMATTR InstName R30
SYMATTR Value 1.5k
SYMBOL res 832 1376 R0
WINDOW 0 36 51 Left 2
SYMATTR InstName R31
SYMATTR Value 1.5k
SYMBOL res 496 1632 R0
SYMATTR InstName R32
SYMATTR Value 1Meg
SYMBOL res 496 1952 R0
SYMATTR InstName R33
SYMATTR Value 1Meg
SYMBOL Opamps\\LTC2054 -784 2096 R0
SYMATTR InstName U1
TEXT -656 2312 Left 2 !.tran 0 20 0 1m startup uic
TEXT -272 1416 Left 2 ;1mA * 0.1ohm ---x100---> 0.01V ---x10---> 0.1V\n-60mA * 0.1ohm ---x100---> -0.6V
